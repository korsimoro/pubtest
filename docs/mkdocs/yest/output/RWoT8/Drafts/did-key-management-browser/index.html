<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Did key management browser - RWoT DIR Launchpad</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Outline", url: "#_top", children: [
          ]},
          {title: "Abstract", url: "#abstract", children: [
              {title: "Introduction", url: "#introduction" },
              {title: "Glossary", url: "#glossary" },
              {title: "Key Storage", url: "#key-storage" },
              {title: "Multi-Device", url: "#multi-device" },
              {title: "Authentication", url: "#authentication" },
              {title: "Frequent DID actions", url: "#frequent-did-actions" },
              {title: "Key Recovery", url: "#key-recovery" },
              {title: "Multiple Identities", url: "#multiple-identities" },
              {title: "User Experience", url: "#user-experience" },
              {title: "Web APIs", url: "#web-apis" },
              {title: "Specific DID Methods", url: "#specific-did-methods" },
              {title: "Threats", url: "#threats" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <p>By Alberto Elias, AndrÃ© Cruz and JoÃ£o Santos</p>
<h1 id="outline">Outline</h1>
<ul>
<li><a href="#outline">Outline</a></li>
<li><a href="#abstract">Abstract</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#glossary">Glossary</a></li>
<li><a href="#key-storage">Key Storage</a><ul>
<li><a href="#storage">Storage</a></li>
<li><a href="#vault">Vault</a></li>
<li><a href="#keychain">Keychain</a></li>
<li><a href="#shared-storage">Shared Storage</a></li>
<li><a href="#cache">Cache</a></li>
<li><a href="#keys">Keys</a></li>
<li><a href="#master-key">Master Key</a></li>
<li><a href="#device-key">Device Key</a></li>
<li><a href="#session-key">Session Key</a></li>
</ul>
</li>
<li><a href="#multi-device">Multi-Device</a><ul>
<li><a href="#replication">Replication</a></li>
<li><a href="#concurrent-updates">Concurrent Updates</a></li>
</ul>
</li>
<li><a href="#authentication">Authentication</a><ul>
<li><a href="#pairwise-dids">Pairwise DIDs</a></li>
</ul>
</li>
<li><a href="#frequent-did-actions">Frequent DID actions</a></li>
<li><a href="#key-recovery">Key Recovery</a></li>
<li><a href="#multiple-identities">Multiple Identities</a></li>
<li><a href="#user-experience">User Experience</a></li>
<li><a href="#web-apis">Web APIs</a><ul>
<li><a href="#webauthn">WebAuthn</a></li>
</ul>
</li>
<li><a href="#specific-did-methods">Specific DID Methods</a></li>
<li><a href="#threats">Threats</a><ul>
<li><a href="#stolen-device">Stolen Device</a></li>
<li><a href="#mitm">MITM</a></li>
<li><a href="#web-extensions">Web Extensions</a></li>
<li><a href="#3rd-party-libraries">3rd Party Libraries</a></li>
</ul>
</li>
</ul>
<h1 id="abstract">Abstract</h1>
<p>There are many projects implementing DIDs, and different DID methods, in many different ways. This paper examines the specific requirements for the Web and browsers. The Web has a different security model than native platforms (e.g. mobile apps) and even, limited access to native device capabilities (e.g secure cryptoprocessor chips). We explore these limitations and how they apply to DID key management including, but not limited to, authentication, signing, key storage, key recovery, synchronization across multiple devices and user experience.</p>
<h2 id="introduction">Introduction</h2>
<p>DIDs are highly dependant on asymmetric cryptographic keys. We use these keys to prove ownership of a DID and to do different actions from that identity. If we lose them, we lose control of our identity. There are many ways to mitigate these risks with different key recovery methods, using proxy keys or actual key management on a device. Key management on the browser has different limitations for secure key management.</p>
<h2 id="glossary">Glossary</h2>
<p>Cryptographic Keys:</p>
<p>Master Key:</p>
<p>Device Key:</p>
<p>Session Key: </p>
<p>Vault:</p>
<p>Keychain:</p>
<p>Cache:</p>
<p>Device Secret:</p>
<p>Shared Secret:</p>
<p>Web Extension:</p>
<p>Lock: </p>
<h2 id="key-storage">Key Storage</h2>
<p>Storing keys in the browser has a specific limitation native applications don't have: you can't hide anything. Storage is only limited by the origin, but many things can access that storage like 3rd party libraries, a web extension or a physical person with device access. That forces us to encrypt all stored data, but whatever you use to encrypt/decrypt (passphrase, finger print, iris scannerâ€¦) can't be stored on the device. We end up with the person having to introduce the encryption lock, but prompting for that lock would mean a bad user experience. Here we examine a possible solution which attempts to balance user experience with security.</p>
<p>We propose 4 storage blobs: vault, keychain, shared storage and cache; 3 types of keys: master key, device key and session key; and 2 types of secrets: device secret and shared secret.</p>
<h3 id="storage">Storage</h3>
<p>We store different elements related to the identity like keys tied to the identity, encryption secrets, verifiable credentials or the DID Document. Depending on its use and importance, we will require different storage options: vault, keychain, shared storage and cache.</p>
<h4 id="vault">Vault</h4>
<p>There is one vault per device. The vault is only unlocked using different locks provided by the person. These could be, but not limited to: passphrase, finger print, iris scan, behaviour biometrics etc. The vaults sole purpose is to store the <em>Device Secret</em> (more below), which is used to encrypt everything else that is stored on the device. If there is information stored regarding multiple identities, they will all be encrypted by the same <em>Device Secret</em> stored in the single Vault.</p>
<p>When entering a DID Key Management app for the first time on a device, the Vault is the first thing that is created. All other storage options MUST use the <em>Device Secret</em> to encrypt their data.</p>
<h4 id="keychain">Keychain</h4>
<p>There is one keychain per identity. They keychain stores the <em>Device Key</em> and <em>Shared Key</em> for each identity.</p>
<h4 id="shared-storage">Shared Storage</h4>
<p>Information like Verifiable Credentials that must be in sync between all devices that control an identity are added to the <strong>Shared Storage</strong>. Information is encrypted with the <em>Shared Secret</em> before being encrypted with the <em>Device Secret</em>.</p>
<h4 id="cache">Cache</h4>
<p>Information like the DID Document or a public profile will be accessed frequently, and resolving it could add a significant lag to the experience. Non-critical and public information will be added to the cache.</p>
<h3 id="keys">Keys</h3>
<h4 id="master-key">Master Key</h4>
<p>There is 1 <em>Master Key _per identity. This is generated when an identity is created. Some DID methods may differ, but generally, we can abstract it to one key. The</em> <strong>Master Key</strong>_ SHOULD be stored in the Vault until the DID is fully created in case of a problem and the identity creation process needs to be restarted. Once the DID has been created, the <strong>Master Key</strong> MUST be deleted, though the person MUST have some way of backing it up before (e.g. saving a seed phrase, using a service).</p>
<h4 id="device-key">Device Key</h4>
<p>There is a <em>Device Key</em> per device per identity. All specific actions with the identity on a specific device is done with the <em>Device Key</em>.</p>
<p>They can only be revoked using the <strong>Master Key</strong>. </p>
<p>Even if a device gets stolen, the robber won't be able to use most features without unlocking the Device Private Key as all the information stored locally will be encrypted with the Device Public Key.</p>
<h4 id="session-key">Session Key</h4>
<p>There is a <strong>Session Key </strong>per application per device per identity. When an application does DID Auth with the Key Manager, it creates a <strong>Session Key</strong> so the application can sign on behalf of the person without needing to prompt constantly. </p>
<p>They are revoked using the <strong>Device Key</strong>.</p>
<h2 id="multi-device">Multi-Device</h2>
<p>Once an Identity has been imported to a new device, the new device will need to receive the <em>Share Key</em> via some transport (LibP2P, Secure Web Sockets, Bluetooth, NFC, QR Code...). </p>
<p>Any meaningful event on the Key Manager, such as the removal of an identity or the addition of a Verifiable Credential, will be broadcasted to interested parties. This allows applications to immediately react to certain events by subscribing to them on the Key Manager.</p>
<h3 id="replication">Replication</h3>
<h3 id="concurrent-updates">Concurrent Updates</h3>
<h2 id="authentication">Authentication</h2>
<p>The session is composed of a key-pair <em>Session Key</em> where the public key is known by both, serving as the session identifier, while the private key is only known by Key Manager. Additionally, all sessions have a max-age, meaning they expire as time passes.</p>
<h3 id="pairwise-dids">Pairwise DIDs</h3>
<h2 id="frequent-did-actions">Frequent DID actions</h2>
<p>An identity is constantly interacting with other identities, them being people or devices or organizations. They exchange Verifiable Credentials, capabilities and other varied types of messages. As these interactions occur constantly, we expect them to happen seamlessly for people for a good user experience. For DIDs, most of these interactions depend on signing information. Based on our proposal, this is done via the <em>Session Key _or the _Device Key</em>.</p>
<p>(Details tradeoffs)</p>
<p>A less common action is updating a DID Document, which we should also evaluate.</p>
<h2 id="key-recovery">Key Recovery</h2>
<p>This is specific to each DID method and has no implications to the browser model apart from the issues mentioned in Key Storage.</p>
<h2 id="multiple-identities">Multiple Identities</h2>
<h2 id="user-experience">User Experience</h2>
<p>None of this work makes sense if people don't actually use our identity systems. That's why we prioritise user experience and make it a strict limitation when analyzing different options and tradeoffs. </p>
<h2 id="web-apis">Web APIs</h2>
<h3 id="webauthn">WebAuthn</h3>
<p>The emergence of web libraries designed to deal with storage and access control to keys that can be used for strong authentication purpose, such as WebAuthN can be leveraged to manage access control to the Vault. Features such as biometric authentication (by a fingerprint reader) ensure a good user experience, but can be a single point of failure (e.g. the user's finger/fingerprint reader might get damaged).</p>
<h2 id="specific-did-methods">Specific DID Methods</h2>
<p>Different DID methods have different limitations. Some depend entirely on the concept of a <em>Master Key</em>, others have a proxy setup with the actual controller of an identity (e.g. a smart contract like ERC 725). A feature which appears to be comons across all DID methods is that at any point in time, there is a certain secret key which gives the party in its control the capability do act on behalf of that identity. Thus, a possible strategy to offer a DID agnostic platform is to use the the Vault to provide access to these secrets. For example, in the case of IPID, the vault would store the RSA or ed25519 key which gives access to the IPID DID Document, while in the case of ERC725 the vault would store an ECDSA private key (which could then be used to generate the public key, and Ethereum address).</p>
<h2 id="threats">Threats</h2>
<h3 id="stolen-device">Stolen Device</h3>
<h3 id="mitm">MITM</h3>
<h3 id="web-extensions">Web Extensions</h3>
<h3 id="3rd-party-libraries">3rd Party Libraries</h3>
<p>Resources:</p>
<ul>
<li><a href="https://github.com/digitalbazaar/crypto-ld">https://github.com/digitalbazaar/crypto-ld</a> <ul>
<li>A Javascript library for cryptographic operations using Linked Data</li>
</ul>
</li>
<li><span style="text-decoration:underline;">ðŸŒŸ <a href="https://github.com/digitalbazaar/web-credential-handler">https://github.com/digitalbazaar/web-credential-handler</a></span></li>
<li><a href="https://github.com/digitalbazaar/did-cli">https://github.com/digitalbazaar/did-cli</a> <ul>
<li>Did-cli for the VEres-one ledger</li>
</ul>
</li>
<li><a href="https://w3c.github.io/web-ledger/">https://w3c.github.io/web-ledger/</a> <ul>
<li>A format and protocol for decentralized ledgers on the Web</li>
</ul>
</li>
<li><a href="https://github.com/digitalbazaar/authorization.io">https://github.com/digitalbazaar/authorization.io</a> <ul>
<li>A Credential Handler is an event handler for credential request and credential storage events. The <a href="https://w3c-ccg.github.io/credential-handler-api">Credential Handler API</a>helps solve the <a href="https://indieweb.org/NASCAR_problem">Nascar Problem</a>. The <a href="https://w3c-ccg.github.io/credential-handler-api">Credential Handler API</a> enables websites to install Credential Handlers that can respond when users visit other websites that request or store credentials.</li>
</ul>
</li>
<li>ðŸŒŸ <strong><a href="https://github.com/digitalbazaar/did-io">https://github.com/digitalbazaar/did-io</a> </strong><ul>
<li><strong>A <a href="https://w3c-ccg.github.io/did-spec/">DID</a> (Decentralized Identifier) resolution library for Javascript</strong></li>
</ul>
</li>
<li><a href="https://github.com/digitalbazaar/web-ledger-cli">https://github.com/digitalbazaar/web-ledger-cli</a> </li>
</ul>

  <br>
</div>

<footer class="col-md-12 wm-page-content"><p>All of the contents of this directory are licensed CC-BY their contributors, unless otherwise noted.</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>