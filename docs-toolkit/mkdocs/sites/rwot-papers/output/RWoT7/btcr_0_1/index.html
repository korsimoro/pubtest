<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>BTCR v0.1 Decisions - RWoT Final Papers</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "BTCR v0.1 Decisions", url: "#_top", children: [
              {title: "Abstract", url: "#abstract" },
              {title: "Overview", url: "#overview" },
              {title: "Scope Clarifications", url: "#scope-clarifications" },
              {title: "Semantics", url: "#semantics" },
              {title: "Wallet requirements and functionality", url: "#wallet-requirements-and-functionality" },
              {title: "Credential schema and content", url: "#credential-schema-and-content" },
              {title: "Example", url: "#example" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h1 id="btcr-v01-decisions">BTCR v0.1 Decisions</h1>
<p>Authors: Kim Hamilton Duffy, Christopher Allen, Dan Pape</p>
<p>Contributors: Ryan Grant, Anthony Ronning, Ganesh Annan, Wolf McNally</p>
<h2 id="abstract">Abstract</h2>
<p>The Bitcoin Reference (BTCR) DID method supports DIDs using the Bitcoin blockchain. This method has been under development through Rebooting Web of Trust events and hackathons over the past year. The BTCR method's reliance on the Bitcoin blockchain presents both advantages and design challenges. During RWOT7, the authors made a number of design and implementation decisions -- largely scope-cutting in nature -- in order to lock down a Minimum Viable Product (MVP) version, which we'll refer to as v0.1. This paper documents those decisions, which will apply to the upcoming v0.1 BTCR method specification and associated v0.1 BTCR reference implementation.</p>
<h2 id="overview">Overview</h2>
<p>The design decisions include:
- What's in and out of scope
- BTCR semantics
- Wallet MVP requirements and functionality
- Credential schema and content</p>
<h2 id="scope-clarifications">Scope Clarifications</h2>
<p>To reduce design and implementation complexity, we decided on some reductions for a 0.1 release of BTCR. A variety of factors influenced these decisions, including lack of library support for our MVP scenarios and our desire for simplicity. Later versions of BTCR will address more advanced scenarios, including cost reduction, improved library security, and, most significantly, support for the mainnet chain. </p>
<h3 id="1-assume-p2pkh-scripts">1. Assume P2PKH scripts</h3>
<p>Our initial BTCR prototypes relied on Pay-to-Public-Key-Hash (P2PKH) scripts. We explored other script types, but these introduced complications for extracting the signing public key directly from the transaction, which we require for the final DID document.</p>
<p>For this reason, we decided that only P2PKH scripts are supported, and other scripts types -- for example P2SH and Segwit -- are out of scope.</p>
<p>Because of the size and cost implications, we will revisit this decision in later versions.</p>
<h3 id="2-only-an-http-url-in-op_return-note-no-ipfs-support">2. Only an HTTP URL in OP_RETURN (Note: no IPFS support)</h3>
<h4 id="backgroundcontext">Background/Context</h4>
<p>A BTCR transaction allows an optional OP_RETURN field pointing to a "continuation" DID document, which is a DID document containing additional key material and capabilities to be merged into the final BTCR DID Document (generated by the resolver).</p>
<p>The storage type of the continuation document introduced a fork during DID document resolution: if the link in the transaction pointed to mutable storage, the document could be updated after the transaction with the known DID (which isn't known until after the tx has been confirmed). However, if the link was a cryptographic hash link, then the document could not be changed without invalidating the hash.</p>
<p>Our original documentation described two paths to address these scenarios:
- If the document is in an immutable store, we consider the transaction signature an implicit signature on the immutable content.
- Otherwise, require a signature on the continuation DID document.</p>
<p>However, this introduces a requirement for the resolvers to be aware of different link types (which are content hashes or not), which we've tracked <a href="https://github.com/w3c-ccg/didm-btcr/issues/2">here</a>.</p>
<h4 id="v01-scope-reduction-no-special-path-for-immutable-continuation-did-documents">v0.1 Scope Reduction: no special path for immutable continuation DID documents</h4>
<p>The BTCR team strongly prefers use of immutable storage for its simplicity; however, we considered the burden of ensuring availability of IPFS objects prohibitive for evaluting BTCR DIDs in end-to-end scenarios. This would require the user to run an IPFS node (or have their objects pinned on one), and this isn't feasible on a mobile device. For example, on an iPhone (our MVP target device) the IPFS lib on iPhone has to be running all the time, and canâ€™t be running in the background.</p>
<p>For these reasons, we decided to wait for greater support for IPFS on iPhone or to use something like filecoin. In v0.1 we will assume that, if the OP_RETURN is present, it points to an HTTP URL. We also assume that the target content could have been altered.</p>
<p>This allows us to cut scope and address the case of mutable storage only.</p>
<h3 id="3-txrefs-and-txref-ext">3. Txrefs and Txref-ext</h3>
<p>The finalization of the txref spec (BIP-0136) is currently still in progress, but we have decided that BTCR DIDs will use the extended form of the txref, which encodes the TXO index within the transaction, as well as the block height and TX index of the transaction itself. See <a href="https://w3c-ccg.github.io/didm-btcr/#txref">here</a> for details. </p>
<h3 id="4-continuation-did-document-in-github-if-the-tx-has-an-op_return">4. Continuation DID Document in github (if the tx has an OP_RETURN)</h3>
<p>Extending on the previous decision, we've decided in v0.1 to store continuation DID Documents in github. The continuation DID Document must be updated after tx confirmation to explicity list fields we formerly derived as part of the implicit DID document.</p>
<p>Specifically, after tx confirmation, the user must specify:
1. the resulting DID in relevant fields such as <code>id</code> and <code>creator</code>. Note this must be done after confirmation because the DID will be known only after the BTCR tx is confirmed.
2. a signature on the updated DID Document from the tx signing key</p>
<p>The decision to store it in github specifically reduces the target audience, since it requires a github account. However, we were already assuming a dev audience for v0.1. </p>
<p>One advantage is of this restriction is the ability to sign DID Document updates with a PGP key (via github signed commits). The flow would look like this:</p>
<ol>
<li>Create BTCR DID</li>
<li>Create the full BTCR DID document in github, including the PGP key in this document<ul>
<li>Note the DID document itself is signed with BTCR transaction signing key, as usual</li>
</ul>
</li>
<li>Commit to github using PGP key from (2).</li>
</ol>
<h3 id="5-testnet-only">5. Testnet only</h3>
<p>Perhaps most notably, we've decided to only support testnet (not mainnet) as we work through the initial reference implementations and obtain feedback from test usage.</p>
<h2 id="semantics">Semantics</h2>
<p>A BTCR DID document relies partially on transaction structure, partially on the continuation DID document. We clarified the semantics of scenarios that were previously undefined. </p>
<h3 id="1-transaction-inputoutput-semantics">1. Transaction input/output semantics</h3>
<h4 id="a-tx-input-addresses">a. TX Input addresses</h4>
<p>In v0.1, the keypair corresponding to the first TX input has the following properties:
- it is the only key that can be used to verify control of the DID and continuation DID document
- it must be used to sign the updated continuation DID document (after TX confirmation)</p>
<p>If an OP_RETURN doesn't exist, the keypair corresponding to the first TX input is granted the following additional capabilities (by the resolver):
- DID auth
- Sign/verify Verifiable Credentials</p>
<p>If the OP_RETURN exists, the continuation DID document obviates the need for additional implicit capabilities; we assume each capability is listed explicitly in the continuation DID document.</p>
<h4 id="b-tx-output-address-1st-monetary-output">b. TX Output address (1st monetary output)</h4>
<p>The output address is used for "following the tip". If spent, the BTCR DID has either been rotated or revoked. Resolvers must follow the tip to find the latest transaction. </p>
<p>Determining whether the DID has been rotated or revoked is described in the next section.</p>
<h3 id="2-no-op_return-after-a-tx-means-revoked">2. No OP_RETURN after a TX means revoked</h3>
<p>A BTCR DID is considered revoked if:
- The latest transaction has no OP_RETURN, AND
- There is more than one transaction in the BTCR DID "chain"</p>
<p>The first factor is important because a missing OP_RETURN is considered valid in the very first TX in the chain. However, all subsequent TXs in the chain must have OP_RETURNs, or else it is considered revoked.</p>
<p>This behavior must be enforced by BTCR resolvers.</p>
<h2 id="wallet-requirements-and-functionality">Wallet requirements and functionality</h2>
<p>We will release a v0.1 BTCR wallet as an iPhone app. We wanted to include sufficient features to demonstrate core BTCR features (as described in the rest of this paper). While defining requirements, we included some usability features and also realized library limitations affecting our implementation choices.</p>
<h3 id="1-import-previous-bitcoin-transactions">1. Import previous Bitcoin transactions</h3>
<p>The v0.1 BTCR wallet implementation will support importing existing private keys corresponding to unspent outputs from previous transactions. This allows users to generate a valid BTCR DID from an existing transaction, with no additional cost.</p>
<p>A consequence is that a transaction doesn't need to be created or broadcast (from within the ID wallet) to instantiate this initial BTCR DID. The BTCR wallet only needs to create transactions for any subsequent update/revoke operations.</p>
<p>In this case, the BTCR DID will have no continuation DID Document.</p>
<h3 id="2-updates-must-use-non-financial-hd-derivation-paths">2. Updates must use non-financial HD derivation paths</h3>
<p>We want to allow users to share mnemonic seeds across their ID wallet and their Bitcoin wallets. To achieve this, we must make sure addresses backing valid DIDs are not accidentally spent, which would result in a BTCR DID revocation.</p>
<p>We will achieve this by choosing our own convention about the derivation path.</p>
<h3 id="3-tip-following">3. Tip following</h3>
<p>Many current BTCR prototypes (such as the BTCR playground) use Bitcoin APIs to look up transactions. This introduces many concerns from security to availability (rate-limiting). </p>
<p>We want our MVP deployment to require minimal resource overhead. To achieve this, our preference is to follow the best practice described in BIP 157/158 (aka Neutrino), which helps preserve the privacy of your DID-related addresses (over SPV). </p>
<blockquote>
<p>Note that Neutrino is not as efficient as SPV. SPV monitors only the addresses it cares about. In contrast, Neutrino introduces noise in attempt to hide the specific addresses it actually cares about.</p>
</blockquote>
<p>The problem we encountered is that library support for Neutrino is not readily available. </p>
<p>As a fallback, we will use REST services backed by a bitcoin node (initially maintained by the BTCR team).</p>
<h3 id="4-pre-revocation">4. Pre-revocation</h3>
<p>The v0.1 BTCR wallet may support pre-revocation in cases of emergency. This works by pre-signing a transaction spending the tip, which can be stored away and broadcast later to revoke the DID even without the key material.</p>
<h2 id="credential-schema-and-content">Credential schema and content</h2>
<p>This section applies to credential schema and content, which is relevant when demonstrating DID use cases. Consistent with the previous decisions, we urge people to use common schemas (for ease of interop) and not to issue high-stakes claims (for privacy/security).</p>
<h3 id="1-use-json-ld-11-javascript-lib-because-01-doesnt-need-high-stakes-verifiers">1. Use JSON-LD 1.1 javascript lib, because 0.1 doesn't need high-stakes verifiers</h3>
<p>As many of the decisions above imply, BTCR v0.1 is not recommended to be used for anything other than experimentation. In a future production-ready version, we will use more secure libraries (and generally avoid reliance on javascript, as we've done for prototyping). </p>
<p>This implies that where JSON-LD libraries are required in BTCR v0.1, we may use the JSON-LD 1.1 javascript library. </p>
<p>In future versions, we will require library support in a different language.</p>
<h3 id="2-restrict-to-schemaorg-schemas-like-person">2. Restrict to schema.org schemas, like person.</h3>
<p>We'll restrict our prototypes to schema.org schemas as opposed to custom schemas. We've developed a <a href="https://github.com/w3c-ccg/did-hackathon-2018/blob/master/BTCR-DID-Tests.md">suite of test cases</a> that can be used.</p>
<h3 id="3-privacy-stick-to-pseudoanonymous-claim-content">3. Privacy: stick to pseudoanonymous claim content</h3>
<p>Users should not include any PII in claims used for BTCR v0.1 prototypes</p>
<h3 id="4-restrict-to-simple-vcs-one-wishes-to-share">4. Restrict to simple VCs one wishes to share</h3>
<p>Similar to above, only include claim content that you want others to see. This phase is not equipped to handle high-stakes scenarios.</p>
<h2 id="example">Example</h2>
<pre><code>{
  &quot;@context&quot;: &quot;https://w3id.org/did/v1&quot;,
  &quot;id&quot;: &quot;did:btcr:8kyt-fzzq-qpqq-ljsc-5l&quot;,
  &quot;publicKey&quot;: [
    {
      &quot;id&quot;: &quot;did:btcr:8kyt-fzzq-qpqq-ljsc-5l#keys-1&quot;,
      &quot;owner&quot;: &quot;did:btcr:8kyt-fzzq-qpqq-ljsc-5l&quot;,
      &quot;type&quot;: &quot;EdDsaSAPublicKeySecp256k1&quot;,
      &quot;publicKeyHex&quot;: &quot;0280e0b456b9e97eecb8028215664c5b99ffa79628b60798edd9d562c6db1e4f85&quot;
    },
    {
      &quot;id&quot;: &quot;did:btcr:8kyt-fzzq-qpqq-ljsc-5l#keys-2&quot;,
      &quot;type&quot;: &quot;RsaVerificationKey2018&quot;,
      &quot;publicKeyPem&quot;: &quot;-----BEGIN PUBLIC KEY...END PUBLIC KEY-----\r\n&quot;,
      &quot;owner&quot;: &quot;did:btcr:8kyt-fzzq-qpqq-ljsc-5l&quot;
    }
  ],
  &quot;authentication&quot;: [
    {
      &quot;type&quot;: &quot;EdDsaSAPublicKeySecp256k1Authentication&quot;,
      &quot;publicKey&quot;: &quot;#keys-1&quot;
    },
    {
      &quot;type&quot;: &quot;RsaSignatureAuthentication2018&quot;,
      &quot;publicKey&quot;: &quot;#keys-2&quot;
    }
  ],
  &quot;service&quot;: [
    {
      &quot;type&quot;: &quot;BTCREndpoint&quot;,
      &quot;serviceEndpoint&quot;: &quot;https://raw.githubusercontent.com/kimdhamilton/did/master/ddo.jsonld&quot;
    }
  ],
  &quot;SatoshiAuditTrail&quot;: [
    {
      &quot;chain&quot;: &quot;testnet&quot;,
      &quot;blockhash&quot;: &quot;0000000000000722ded9d85d67e145ba41c53ef2e8680f75540a08b885febba5&quot;,
      &quot;blockindex&quot;: 2,
      &quot;outputindex&quot;: 1,
      &quot;blocktime&quot;: &quot;2017-09-23T17:27:56.682Z&quot;,
      &quot;time&quot;: 1499501000,
      &quot;timereceived&quot;: &quot;2017-09-23T17:27:56.682Z&quot;,
      &quot;burn-fee&quot;: -0.05
    }
  ],
  &quot;claims&quot;: [

  ]
}
</code></pre>

  <br>
</div>

<footer class="col-md-12 wm-page-content"><p>All of the contents of this directory are licensed CC-BY their contributors, unless otherwise noted.</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>